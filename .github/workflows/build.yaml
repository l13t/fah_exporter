# # .github/workflows/release.yml
# name: goreleaser

# on:
#   workflow_run:
#     workflows: ["Release on merge"]
#     types:
#       - completed
#   # push:
#   #   branches:
#   #     - master
#   #   # run only against tags
#   #   tags:
#   #     - 'v\d+.\d+.\d+'

# permissions:
#   contents: write
#   # packages: write
#   # issues: write
#   # id-token: write

# jobs:
#   goreleaser:
#     runs-on: ubuntu-latest
#     permissions: write-all
#     steps:
#       - name: Setup Qemu
#         uses: docker/setup-qemu-action@v3

#       - name: Checkout
#         uses: actions/checkout@v4
#         with:
#           fetch-depth: 0

#       - name: Set up Go
#         uses: actions/setup-go@v5
#         with:
#           go-version: stable

#       - name: Run GoReleaser
#         uses: goreleaser/goreleaser-action@v6
#         with:
#           # either 'goreleaser' (default) or 'goreleaser-pro'
#           distribution: goreleaser
#           # 'latest', 'nightly', or a semver
#           version: "~> v2"
#           args: release --clean
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
name: CI
on:
  push:
    branches:
      - "**"
  pull_request:
    branches:
      - "**"
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: 1.23
      - uses: golangci/golangci-lint-action@v3
  test:
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: 1.23
      - run: go test -v ./...
  release:
    runs-on: ubuntu-latest
    needs: test
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: 1.23
      - uses: go-semantic-release/action@v1
        with:
          hooks: goreleaser
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
